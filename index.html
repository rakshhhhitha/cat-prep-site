<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Vocabulary Quiz</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .question { font-size: 1.2em; margin-bottom: 10px; }
    .options button { display: block; margin: 5px 0; padding: 10px; width: 300px; }
    .feedback { margin-top: 10px; font-weight: bold; }
    .dashboard { margin-top: 30px; border-top: 1px solid #ccc; padding-top: 20px; }
  </style>
</head>
<body>
  <h1>Vocabulary Quiz</h1>
  <div class="quiz">
    <div class="question" id="questionText"></div>
    <div class="options" id="optionsContainer"></div>
    <div class="feedback" id="feedback"></div>
  </div>
  <div class="dashboard">
    <h2>Dashboard</h2>
    <p>Total Attempts: <span id="totalAttempts">0</span></p>
    <p>Correct Answers: <span id="correctAnswers">0</span></p>
    <p>Accuracy: <span id="accuracy">0%</span></p>
  </div>

  <script>
    let vocabulary = [];
    let totalAttempts = 0;
    let correctAnswers = 0;

    function updateDashboard() {
      document.getElementById("totalAttempts").textContent = totalAttempts;
      document.getElementById("correctAnswers").textContent = correctAnswers;
      const accuracy = totalAttempts ? ((correctAnswers / totalAttempts) * 100).toFixed(2) : 0;
      document.getElementById("accuracy").textContent = accuracy + "%";
    }

    function saveIncorrectAnswer(question, correct, selected) {
      const review = JSON.parse(localStorage.getItem("review") || "[]");
      review.push({ question, correct, selected });
      localStorage.setItem("review", JSON.stringify(review));
    }

    function getRandomItem(array) {
      return array[Math.floor(Math.random() * array.length)];
    }

    function generateQuiz() {
      document.getElementById("feedback").textContent = "";

      const questionTypes = ["Meaning", "Synonym", "Antonym"];
      const questionType = getRandomItem(questionTypes);

      let filteredVocab = vocabulary.filter(entry => {
        if (questionType === "Meaning") return entry.meaning?.trim() !== "";
        if (questionType === "Synonym") return entry.synonym?.trim() !== "";
        if (questionType === "Antonym") return entry.antonym?.trim() !== "";
        return false;
      });

      if (filteredVocab.length === 0) {
        document.getElementById("questionText").textContent = "No valid data found for this question type.";
        return;
      }

      const item = getRandomItem(filteredVocab);
      let questionText = "";
      let correctAnswer = "";
      let options = [];

      if (questionType === "Meaning") {
        questionText = `What is the meaning of "${item.word}"?`;
        correctAnswer = item.meaning.trim();
        options = filteredVocab.map(v => v.meaning).filter(Boolean);
      } else if (questionType === "Synonym") {
        questionText = `Which word is a synonym of "${item.word}"?`;
        const synonyms = item.synonym.split(",").map(s => s.trim()).filter(Boolean);
        correctAnswer = getRandomItem(synonyms);
        options = filteredVocab.flatMap(v => v.synonym.split(",").map(s => s.trim()));
      } else if (questionType === "Antonym") {
        questionText = `Which word is an antonym of "${item.word}"?`;
        const antonyms = item.antonym.split(",").map(a => a.trim()).filter(Boolean);
        correctAnswer = getRandomItem(antonyms);
        options = filteredVocab.flatMap(v => v.antonym.split(",").map(a => a.trim()));
      }

      // Clean options
      options = [...new Set(options.filter(Boolean))];
      if (!options.includes(correctAnswer)) options.push(correctAnswer);
      options = options.sort(() => 0.5 - Math.random()).slice(0, 4);
      if (!options.includes(correctAnswer)) {
        options[Math.floor(Math.random() * 4)] = correctAnswer;
      }

      document.getElementById("questionText").textContent = questionText;
      const container = document.getElementById("optionsContainer");
      container.innerHTML = "";
      options.forEach(option => {
        const btn = document.createElement("button");
        btn.textContent = option;
        btn.onclick = () => {
          totalAttempts++;
          if (option === correctAnswer) {
            correctAnswers++;
            document.getElementById("feedback").textContent = "✅ Correct!";
          } else {
            document.getElementById("feedback").textContent = `❌ Incorrect! Correct answer: ${correctAnswer}`;
            saveIncorrectAnswer(questionText, correctAnswer, option);
          }
          updateDashboard();
          setTimeout(generateQuiz, 2000);
        };
        container.appendChild(btn);
      });
    }

    fetch('vocab-data.json')
      .then(res => res.json())
      .then(data => {
        vocabulary = data;
        updateDashboard();
        generateQuiz();
      })
      .catch(err => {
        console.error("Error loading vocabulary data:", err);
        document.getElementById("questionText").textContent = "Failed to load vocabulary.";
      });
  </script>
</body>
</html>
